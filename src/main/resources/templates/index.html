<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://thymeleaf.org">
<head>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NDZKXK3TET"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-NDZKXK3TET');
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link th:href="@{/public/scooter-style.css}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>


    <link th:href="@{/public/scooter-style.css}" rel="stylesheet">
<!--        <link href="../static/public/scooter-style.css" rel="stylesheet">-->


    <link th:href="@{/public/map-info-window-style.css}" rel="stylesheet">
<!--        <link href="../static/public/map-info-window-style.css" rel="stylesheet">-->

    <title>Welcome</title>

    <!-- Google fonts: Roboto Slab    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap" rel="stylesheet">

    <!-- Lottie player-->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

</head>
<body>
<div class="bg-gradient-dark pb-5">
    <nav class="navbar">
        <a class="navbar-brand m-0" style="display: flex; justify-content: center; align-items: center;" th:href="@{/admin}">
            <lottie-player src="../public/scooter_animation.json"  class="d-inline-block align-top" background="transparent"  speed="1"  style="width: 60px; height: 60px;"  loop  autoplay></lottie-player>
            <h4>Scooters Admin Panel</h4>
        </a>
        <span class="welcome-user text-muted">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
            </svg>
            Welcome <strong>[[${#httpServletRequest.remoteUser}]]</strong>!
        </span>
    </nav>
    <div class="inner-container pt-5">
        <div class="row">
            <div class="col-12 col-sm-6 col-xl-6 mt-1 grid-margin">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h4 style="margin: 0;">List Scooters</h4>
                            </div>
                            <div class="icon-box icon-box-bg-image-warning">
                                <a style="padding: 8px 9px; padding-top:6px;" class="btn-outline btn-sm"   th:href="@{/admin/scooters/}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-ul" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-xl-6 mt-1 grid-margin">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h4 style="margin: 0;">Create Scooter</h4>
                            </div>
                            <div class="icon-box icon-box-bg-image-info">
                                <a style="padding: 8px 9px; padding-top:6px;" class="btn-outline btn-sm"   th:href="@{/admin/createScooter}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <section class="pt-3 pb-4" id="count-stats" >
        <div class="container">
            <div class="row">
                <div class="col-lg-9 z-index-2 border-radius-xl mt-n10 mx-auto py-3 blur shadow-blur">
                    <div class="row">
                        <div class="col-md-3 position-relative">
                            <div class="p-3 text-center">
                                <h1 class="text-gradient text-primary"><span id="state1" countto="300" th:text="${states.get(0)}"></span></h1>
                                <h5 class="mt-3">In use</h5>
                                <!--<p class="text-sm">Dummy text</p>-->
                            </div>
                            <hr class="vertical dark">
                        </div>
                        <div class="col-md-3 position-relative">
                            <div class="p-3 text-center">
                                <h1 class="text-gradient text-success"> <span id="state2" countto="100" th:text="${states.get(1)}"></span></h1>
                                <h5 class="mt-3">Out of use</h5>
                                <!--<p class="text-sm">Dummy text</p>-->
                            </div>
                            <hr class="vertical dark">
                        </div>
                        <div class="col-md-3 position-relative">
                            <div class="p-3 text-center">
                                <h1 class="text-gradient text-danger"> <span id="state3" countto="100" th:text="${states.get(2)}"></span></h1>
                                <h5 class="mt-3">Broken</h5>
                                <!--<p class="text-sm">Dummy text</p>-->
                            </div>
                            <hr class="vertical dark">
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 text-center">
                                <h1 class="text-gradient text-warning" id="state4" countto="39" th:text="${states.get(3)}"></h1>
                                <h5 class="mt-3">In service</h5>
                                <!--<p class="text-sm">Dummy text</p>-->
                            </div>
                            <hr class="vertical dark">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</div>


<div class="bg-gradient-light pt-5"  style="padding-bottom:1rem;">
    <div class="maps-container card mt-2" >
        <div class="card-body">

            <div class="mapContainer" style="height: 60vh;">
                <div id="map"></div>
            </div>

        </div>
    </div>
</div>



<script th:inline="javascript">
    /*<![CDATA[*/

    var scooters = /*[[${scooters}]]*/ null;

    let map;

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 46.77254971477885, lng: 23.621516628328187 },
            zoom: 13,
            clickableIcons: false,
            // gestureHandling: "greedy",
        });

        const image = {
            // url:  "../static/public/mapsPin.svg",
            url:  "/public/mapsPin.svg",
            size: new google.maps.Size(80, 80),
            scaledSize: new google.maps.Size(80, 80),
        }



        scooters.forEach(scooter => {
            console.log(scooter);
            const marker = new google.maps.Marker({
                position: { lat: parseFloat(scooter.latitude), lng: parseFloat(scooter.longitude) },
                map,
                icon: image,
            });

            const scooterHref = "/admin/scooters/" + scooter.documentName;

            const contentString =
                '<div class="map-info-container">'+
                '<h4 class="title-info-window">'+scooter.documentName+'</h4>' +
                '<div class="underline-info"></div>'+
                '<p> <b style="font-weight: bold">State: </b>'+ scooter.state+'</p>'+
                '<p> <b style="font-weight: bold">Price: </b>'+ scooter.cost +' RON</p>'+
                '<a class="link-info-window" href="'+ scooterHref+'">click for more details</a>'+
                "</div>";

            const infowindow = new google.maps.InfoWindow({
                content: contentString,
            });

            marker.addListener("click", () => {
                infowindow.open({
                    anchor: marker,
                    map,
                    shouldFocus: false,
                });
            });

        });

    }
    /*]]>*/
</script>


<!-- Async script executes immediately and must be after any DOM elements used in callback. -->
<script th:src="|https://maps.googleapis.com/maps/api/js?key=${mapsApiKey}&callback=initMap&v=weekly|"
        async
></script>


</body>
</html>